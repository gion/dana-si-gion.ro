"use strict";!function(a,b,c,d,e,f,g,h,i,j){c(document).ready(function(c){function i(){c("html").on("click",".prevent-default",function(a){a.preventDefault()})}function k(){b.myScroll=new j("#example-wrapper",{mouseWheel:!0,mouseWheelSpeed:10,scrollX:!1,scrollY:!0,scrollbars:!0,interactiveScrollbars:!0,shrinkScrollbars:"scale",useTransform:!1,useTransition:!1,probeType:3}),b.controller.scrollPos(function(){return-b.myScroll.y}),b.myScroll.on("scroll",function(){b.controller.update()})}function l(){var a=c("body");c(".lang-selector").on("click",function(){a.toggleClass("lang-en")})}function m(){var b=!1,d=c("#example-wrapper"),e=c(a),f=function(a){d.toggleClass("grabbing",a)};d.on("mousedown",function(){e.on("mousemove.drag",function(){b!==!0&&(b=!0,f(b)),c(a).off("mousemove.drag")})}).on("mouseup",function(){e.off("mousemove.drag"),b=!1,f(b)})}function n(){var d=c(a),e=1100,f=d.height(),g=c(".scrollContent").outerHeight();b.backgroundScene.duration(g-f/2),b.bikeScene.duration(g-f/2),c.each(r,function(a,b){c(b.triggerElement())}),c(".scene-element-wrapper").width(e),c(".scene-element").css("transformOrigin",e/2+100+"px "+(f/2+100)+"px"),c("#origin-helper").css({top:f/2+(c(".scene.active .scene-element-wrapper").length?c(".scene.active .scene-element-wrapper").offset().top:0),left:e/2}),c(".full-width").width(d.width()).css({left:-(d.width()-e)/2+50})}function o(){var a=new Date,b=new Date("Wed Aug 16 2014 16:00:00 GMT+0300 (EEST)"),c=Math.abs(b.getTime()-a.getTime()),d=Math.ceil(c/864e5);return d}function p(){c(".days-left").text(o())}function q(){c.each(b.scenes,function(){c('<li class="bullet heart cursor-pointer"></li>').appendTo("#bullets")})}c("#bullets").on("click",".bullet",function(a){var d=c(a.target).index();b.goToScene(d)}),b.animateScroll=function(a){b.myScroll.scrollTo(0,-a,2e3,j.utils.ease.circular)},b.goToScene=function(d){var e,f=b.scenes[d];return f?(e=f.startPosition()-c(a).height()/2+.2*f.duration(),void b.animateScroll(e)):(console.error("not a valid index scene",d),!1)},b.getBubbles=function(){return b.getBubbles.promise||(b.getBubbles.promise=c.ajax({url:"data/bubbles.json",method:"get",dataType:"json"})),b.getBubbles.promise},b.renderBubbles=function(a){var b=d.template('<a class="<%=scene%>" target="blank" title="<%=title%>" href="<%=link%>" style="background-image: url(<%=image%>)"></a>'),e=c(".bubble-3").empty();c.each(a,function(a,c){e.append(b(c))})},b.initBubbles=function(){b.getBubbles().success(b.renderBubbles)},b.activateBubble=function(a){c(".bubble-wrapper .bubble-3 a."+a).addClass("active").length&&c(".bubble-wrapper").addClass("active")},b.deactivateBubble=function(a){c(".bubble-wrapper, .bubble-wrapper .bubble-3 a."+a).removeClass("active")},b.onTimelineUpdate=function(){var a=this.progress(),c=.15,d=.8;a>c&&d>a&&!this.bubbleActivated?(this.bubbleActivated=!0,b.activateBubble(this.sceneName)):(c>a||a>d)&&this.bubbleActivated&&(this.bubbleActivated=!1,b.deactivateBubble(this.sceneName))},b.sound={playing:!1,loaded:!1,player:null,updatePlayerState:function(a){c("#music a").each(function(b,d){var e=c(d),f=e.attr("class").split(/\s+/g).filter(function(a){return-1===a.indexOf("music-")});f.push("music-"+a),e.attr("class",f.join(" ")),e.attr("title",e.data(a))})},onPlayerReady:function(a){a.target.playVideo()},onPlayerStateChange:function(c){c.data===a.YT.PlayerState.ENDED?(b.sound.playing=!1,b.sound.updatePlayerState("on")):c.data===a.YT.PlayerState.PAUSED?(b.sound.playing=!1,b.sound.updatePlayerState("on")):c.data===a.YT.PlayerState.PLAYING&&(b.sound.playing=!0,b.sound.updatePlayerState("off"))},loadVideo:function(){b.sound.loaded=!0,b.sound.updatePlayerState("loading"),c.getScript("https://www.youtube.com/iframe_api"),a.onYouTubeIframeAPIReady=function(){b.sound.player=new a.YT.Player("player",{height:"0",width:"0",videoId:"8_2xTSfEVMM",events:{onReady:b.sound.onPlayerReady,onStateChange:b.sound.onPlayerStateChange}})}},clickHandler:function(){b.sound.playing?b.sound.player.pauseVideo():b.sound.loaded?b.sound.player.playVideo():b.sound.loadVideo(),b.sound.playing=!b.sound.playing},init:function(){c("#music").on("click","a",b.sound.clickHandler),b.sound.updatePlayerState("on")}};var r=b.scenes=[],s=b.controller=new g({container:"#example-wrapper"}),t=c(".clouds"),u=e.to("#mobileadvanced #hill",1,{rotation:"-360deg",onUpdate:function(){var a=-(100*this.progress())+"% 0";t.css("background-position",a)}}),v=b.backgroundScene=new h({triggerElement:c("#background").get(0),duration:c(".scrollContent").height()}).setTween(u).setPin("#mobileadvanced",{pushFollowers:!1}).addTo(s);v.tween=u,v.on("enter",function(){c("body").removeClass("finished"),c("body").addClass("scene-background"),c(v.triggerElement()).addClass("active")}),v.on("leave",function(){c(v.triggerElement()).removeClass("active"),c("body").addClass("finished"),c("body").removeClass("scene-background")}),c(".scene.fixed:last").each(function(a,d){var f=new h({triggerElement:d,duration:c(".scrollContent").height(),offset:-200});c(".scene-element-wrapper",d).each(function(a,b){var d=c(".scene-element",b).get(0);f.setPin(b,{pushFollowers:!1}).setTween(e.fromTo(d,1,{rotation:"0deg"},{rotation:"100deg"})),f.tween=u}),f.on("enter",function(){c(f.triggerElement()).addClass("active")}),f.on("leave",function(){c(f.triggerElement()).removeClass("active")}),b.bikeScene=f,f.addTo(s)}),c(".scene:not(.fixed)").each(function(a,d){var g=new h({triggerElement:d,offset:-200,duration:c(d).data("duration")||c(d).height()}),i=c(d).attr("id"),j=new f({onUpdate:b.onTimelineUpdate});j.sceneName=i,c(".scene-element-wrapper",d).each(function(a,b){var d=c(".scene-element",b).get(0),f=(c(".scene-description",b),e.fromTo(d,1,{rotation:"110deg"},{rotation:"-90deg"}));j.add(f)});var k=r.length,l=c("body"),m=c(g.triggerElement());g.on("enter",function(){m.addClass("active"),c("#bullets .bullet").eq(k).addClass("active"),l.addClass("scene-"+i)}),g.on("leave",function(){c("#bullets .bullet").eq(k).removeClass("active"),m.removeClass("active"),l.removeClass("scene-"+i)}),g.setTween(j),g.tween=j,g.addTo(s),r.push(g)});var w=e.fromTo(".good-morning-1",1,{top:"-600px"},{top:0});b.scenes[5].tween.add(w);var x=e.to("#the-wall img.the-wall",1,{top:"-1000px"});b.scenes[8].tween.add(x);var y=e.fromTo("#the-proposal .ring",1,{"margin-top":"-1000px","margin-left":"720px"},{"margin-top":"150px","margin-left":"25px",onStart:function(){c("#the-proposal .hand").addClass("active")},onUpdate:function(){var a=this.progress();this._animatedRing?(.7>a||a>.95)&&(c("#the-proposal .ring").removeClass("active"),this._animatedRing=!1):a>.7&&(c("#the-proposal .ring").addClass("active"),this._animatedRing=!0)},onComplete:function(){c("#the-proposal .hand").removeClass("active")}});b.scenes[9].tween.add(y);var z=c("#never .paws"),A=e.to({x:0},1,{x:1,onStart:function(){z.attr("class","scrolling-element paws")},onUpdate:function(){for(var a=this.progress(),b=16,c=Math.ceil(a/(1/b)),d=["scrolling-element","paws"],e=1;c>=e;e++)d.push("step-"+e);z.attr("class",d.join(" "))}});b.scenes[10].tween.add(A);var B=e.fromTo("#civila img.bikes",1,{top:"1000px"},{top:"-1500px"});b.scenes[11].tween.add(B),b.controller.update(),c(a).on("resize",n),n(),k(),q(),m(),l(),b.initBubbles(),i(),p(),b.sound.init()})}(this,this.api=this.api||{},this.jQuery,this._,this.TweenMax,this.TimelineMax,this.ScrollMagic,this.ScrollScene,this.Modernizr,this.IScroll);